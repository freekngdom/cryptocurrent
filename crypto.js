var coinMarketCapData = [
  {
    id: "bitcoin",
    name: "Bitcoin",
    symbol: "BTC",
    rank: "1",
    price_usd: "11111.7",
    price_btc: "1.0",
    "24h_volume_usd": "7702020000.0",
    market_cap_usd: "187745505540",
    available_supply: "16896200.0",
    total_supply: "16896200.0",
    max_supply: "21000000.0",
    percent_change_1h: "0.34",
    percent_change_24h: "1.29",
    percent_change_7d: "7.61",
    last_updated: "1520033065"
  },
  {
    id: "ethereum",
    name: "Ethereum",
    symbol: "ETH",
    rank: "2",
    price_usd: "861.09",
    price_btc: "0.0775311",
    "24h_volume_usd": "1912980000.0",
    market_cap_usd: "84340217647.0",
    available_supply: "97945880.0",
    total_supply: "97945880.0",
    max_supply: null,
    percent_change_1h: "0.2",
    percent_change_24h: "-1.31",
    percent_change_7d: "-0.07",
    last_updated: "1520033052"
  },
  {
    id: "ripple",
    name: "Ripple",
    symbol: "XRP",
    rank: "3",
    price_usd: "0.912796",
    price_btc: "0.00008219",
    "24h_volume_usd": "274482000.0",
    market_cap_usd: "35682981713.0",
    available_supply: "39091956706.0",
    total_supply: "99992520283.0",
    max_supply: "100000000000",
    percent_change_1h: "-0.03",
    percent_change_24h: "-1.9",
    percent_change_7d: "-8.7",
    last_updated: "1520033041"
  },
  {
    id: "bitcoin-cash",
    name: "Bitcoin Cash",
    symbol: "BCH",
    rank: "4",
    price_usd: "1282.81",
    price_btc: "0.115502",
    "24h_volume_usd": "422690000.0",
    market_cap_usd: "21803183954.0",
    available_supply: "16996425.0",
    total_supply: "16996425.0",
    max_supply: "21000000.0",
    percent_change_1h: "0.41",
    percent_change_24h: "-0.54",
    percent_change_7d: "0.61",
    last_updated: "1520033054"
  },
  {
    id: "litecoin",
    name: "Litecoin",
    symbol: "LTC",
    rank: "5",
    price_usd: "209.392",
    price_btc: "0.0188533",
    "24h_volume_usd": "602303000.0",
    market_cap_usd: "11611327292.0",
    available_supply: "55452583.0",
    total_supply: "55452583.0",
    max_supply: "84000000.0",
    percent_change_1h: "1.19",
    percent_change_24h: "-0.71",
    percent_change_7d: "-1.17",
    last_updated: "1520033041"
  },
  {
    id: "neo",
    name: "NEO",
    symbol: "NEO",
    rank: "6",
    price_usd: "125.086",
    price_btc: "0.0112625",
    "24h_volume_usd": "150486000.0",
    market_cap_usd: "8130590000.0",
    available_supply: "65000000.0",
    total_supply: "100000000.0",
    max_supply: "100000000.0",
    percent_change_1h: "0.22",
    percent_change_24h: "-3.34",
    percent_change_7d: "2.51",
    last_updated: "1520033048"
  },
  {
    id: "cardano",
    name: "Cardano",
    symbol: "ADA",
    rank: "7",
    price_usd: "0.295033",
    price_btc: "0.00002656",
    "24h_volume_usd": "108917000.0",
    market_cap_usd: "7649341402.0",
    available_supply: "25927070538.0",
    total_supply: "31112483745.0",
    max_supply: "45000000000.0",
    percent_change_1h: "-0.03",
    percent_change_24h: "-3.69",
    percent_change_7d: "-14.46",
    last_updated: "1520033054"
  },
  {
    id: "stellar",
    name: "Stellar",
    symbol: "XLM",
    rank: "8",
    price_usd: "0.322775",
    price_btc: "0.00002906",
    "24h_volume_usd": "39793700.0",
    market_cap_usd: "5961045864.0",
    available_supply: "18468115139.0",
    total_supply: "103728679130",
    max_supply: null,
    percent_change_1h: "-0.07",
    percent_change_24h: "-5.15",
    percent_change_7d: "-15.12",
    last_updated: "1520033043"
  },
  {
    id: "eos",
    name: "EOS",
    symbol: "EOS",
    rank: "9",
    price_usd: "8.12655",
    price_btc: "0.0007317",
    "24h_volume_usd": "216420000.0",
    market_cap_usd: "5717447429.0",
    available_supply: "703551621.0",
    total_supply: "900000000.0",
    max_supply: "1000000000.0",
    percent_change_1h: "1.1",
    percent_change_24h: "-5.03",
    percent_change_7d: "-4.81",
    last_updated: "1520033052"
  },
  {
    id: "monero",
    name: "Monero",
    symbol: "XMR",
    rank: "10",
    price_usd: "343.556",
    price_btc: "0.0309331",
    "24h_volume_usd": "170141000.0",
    market_cap_usd: "5421623242.0",
    available_supply: "15780901.0",
    total_supply: "15780901.0",
    max_supply: null,
    percent_change_1h: "0.51",
    percent_change_24h: "9.48",
    percent_change_7d: "19.95",
    last_updated: "1520033043"
  },
  {
    id: "iota",
    name: "IOTA",
    symbol: "MIOTA",
    rank: "11",
    price_usd: "1.92723",
    price_btc: "0.00017353",
    "24h_volume_usd": "28399000.0",
    market_cap_usd: "5356794147.0",
    available_supply: "2779530283.0",
    total_supply: "2779530283.0",
    max_supply: "2779530283.0",
    percent_change_1h: "1.12",
    percent_change_24h: "-2.98",
    percent_change_7d: "9.57",
    last_updated: "1520033051"
  },
  {
    id: "dash",
    name: "Dash",
    symbol: "DASH",
    rank: "12",
    price_usd: "608.102",
    price_btc: "0.0547525",
    "24h_volume_usd": "101963000.0",
    market_cap_usd: "4813782306.0",
    available_supply: "7916077.0",
    total_supply: "7916077.0",
    max_supply: "18900000.0",
    percent_change_1h: "0.98",
    percent_change_24h: "-1.52",
    percent_change_7d: "-3.91",
    last_updated: "1520033042"
  }
];

var additionalData = [
  "All Time High",
  "Social Sentiment",
  "My Coins",
  "Current BTC Value",
  "Current USD Value",
  "Percent",
  "Local Wallet Quantity",
  "Binance",
  "GDAX",
  "others",
  "Purchase Price USD",
  "Purchase(BTC)",
  "$Gain",
  "%Gain",
  "25%",
  "10%",
  "-5%",
  "Local%",
  "Local Wallet Value",
  "Exchange Value",
  "Public Addresses",
  "ERC20 Contract Address",
  "Description / Notes"
];

/**
 * Parse JSON and render the results in a string template.
 *
 * @param {"coinId"} id
 *        coin id as listed on coinmarketcap api
 * @param {"templateText"} key
 *        string template for rendering results
 * @customfunction
 */
function COINVALUEFROM(id, key) {
  id = id
    .trim()
    .toLowerCase()
    .replace(/ /g, "-");
  //var url = encodeURI("https://api.coinmarketcap.com/v1/ticker/");
  //var response = UrlFetchApp.fetch(url);
  //var obj = JSON.parse(response.getContentText());
  var obj = coinMarketCapData;
  if (!Array.isArray(obj)) {
    obj = [obj];
  }
  var filteredObj = obj.filter(function(thisObj) {
    return thisObj.id == id;
  });
  return key.replace(/\s*(\w+)\s*/g, function(match, varName) {
    return filteredObj[0][varName];
  });
}

function SETHEADERS(obj, sheet, row) {
  obj = coinMarketCapData[0];
  sheet = getSheetWithName("test");
  row = 3;
  var objKeys = Object.keys(obj);
  var range = sheet.getRange(row, 1, 1, parseInt(objKeys.length));
  range.setValues([objKeys]);
}

function getSheetWithName(name) {
  var sheets = SpreadsheetApp.getActiveSpreadsheet().getSheets();
  for (var sheet in sheets) {
    if (sheets.hasOwnProperty(sheet)) {
      var spreadsheet = sheets[sheet];
      if (spreadsheet.getName() === name) {
        return sheets[sheet];
      }
    }
  }
  return null;
}
